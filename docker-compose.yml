# --- Configuration commune ---
x-hadoop-common: &hadoop-common
  build: .
  environment:
    - HADOOP_HOME=/usr/local/hadoop
    - HADOOP_HEAPSIZE_MAX=800m
  deploy:
    resources:
      limits:
        cpus: '1.0'
        memory: 1G
      reservations:
        memory: 512M
  networks:
    - hadoop_network

# --- RÃ©seau ---
networks:
  hadoop_network:
    name: hadoop
    driver: bridge

# --- Services ---
services:
  hadoop-master:
    <<: *hadoop-common
    container_name: hadoop-master
    hostname: hadoop-master
    ports:
      - "9870:9870"
      - "8088:8088"
    command: ["sh", "-c", "service ssh start; tail -f /dev/null"]

  hadoop-worker1:
    <<: *hadoop-common
    container_name: hadoop-worker1
    hostname: hadoop-worker1
    command: ["sh", "-c", "service ssh start; tail -f /dev/null"]

  hadoop-worker2:
    <<: *hadoop-common
    container_name: hadoop-worker2
    hostname: hadoop-worker2
    command: ["sh", "-c", "service ssh start; tail -f /dev/null"]

  hadoop-worker3:
    <<: *hadoop-common
    container_name: hadoop-worker3
    hostname: hadoop-worker3
    command: ["sh", "-c", "service ssh start; tail -f /dev/null"]